# webpack与浏览器缓存(cache)

让浏览器合理做缓存
## 问题背景
在我目前所处的项目中，其中有一个公众信息系统，给安哥拉公民提供一个公众网站做身份证进度查询等使用。当我一次在将新打包的文件部署到服务器中后，打开浏览器请求这个网站时，没有发现新加的功能页面。

## 问题排查
* 起初以为是在部署上除了问题了，于是将这个服务所处的docker容器，以及构建的镜像都删除了，进行了重新构建部署。发现网页能正常打开，但是还是没有看到新加的功能页面。
* 然后怀疑是浏览器缓存的问题，试着清除缓存后，再重新加载页面，这时能正常看到新加的功能页面了。

## 解决问题

虽然上面通过手动清除浏览器缓存，能够正确加载。但是每次更新都需要手动去加载一次页面，会很麻烦，而且在这个国家的公民大部分也不会这个操作。

那么如何从根本上解决这个问题，成了我思考的问题。

既然清除浏览器缓存后能正常加载页面，就想到了从浏览器缓存这个方面去做突破口。

经过一些文章资料和论证，我发现浏览器在加载文件名相同的资源的时候，会优先从缓存里面加载，这个就能解释上面问题出现的原因了。

那么我们如何在打包的时候，根据内容是否变更，去打包并生成不一样的文件名，让浏览器去识别呢？

这个时候又得从打包做入口，由于项目本身也使用webpack做为打包构建工具，在查阅webpack文档时，发现了一个`[contenthash]`的占位符,可以用来根据内容是否变动来生成不一样的hash值，那么就可以完美解决我们的问题啦，我们只需要在文件出口`output`进行如下配置即可

```js
filename: '[name].[contenthash].js',

chunkFilename: '[name].[contenthash].chunk.js', 
```
浏览器在识别到不一样的文件名时，就会加载服务器上的资源进行显示了。虽然最后的解决方式很简单，解决思路值得记录一下。